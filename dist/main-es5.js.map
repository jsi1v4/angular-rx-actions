{"version":3,"sources":["webpack:///src/app/app.service.ts","webpack:///src/app/app.component.ts","webpack:///src/app/app.module.ts","webpack:///src/tools/state.ts","webpack:///src/tools/action.ts","webpack:///src/main.ts","webpack:///$_lazy_route_resource lazy namespace object"],"names":["heroes","name","level","AppService","slice","Math","floor","random","length","pipe","message","AppComponent","appService","request","copy","exec","getHeroes","response","console","log","setValue","error","getVillains","selector","template","styles","changeDetection","OnPush","AppModule","declarations","imports","providers","bootstrap","State","initialValue","source","value","next","asObservable","wrapper","payload","loading","pristine","valid","Action","onSuccess","res","onError","err","mutation","undefined","result","subscribe","bootstrapModule","webpackEmptyAsyncContext","req","Promise","resolve","then","e","Error","code","keys","module","exports","id"],"mappings":"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","file":"main-es5.js","sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { of, throwError } from 'rxjs';\r\nimport { delay, switchMap } from 'rxjs/operators';\r\n\r\nexport interface Hero {\r\n  name: string;\r\n  level: number;\r\n}\r\n\r\nconst heroes: Hero[] = [\r\n  { name: 'Peter', level: 25 },\r\n  { name: 'Tony', level: 50 },\r\n  { name: 'Stephen', level: 99 }\r\n];\r\n\r\n@Injectable()\r\nexport class AppService {\r\n\r\n  constructor() { }\r\n\r\n  getHeroes() {\r\n    return of(heroes.slice(0, Math.floor(Math.random() * heroes.length)))\r\n      .pipe(\r\n        delay(3000)\r\n      );\r\n  }\r\n\r\n  getVillains() {\r\n    return of([])\r\n      .pipe(\r\n        delay(3000),\r\n        switchMap(() => throwError({ message: 'You shall not pass...' }))\r\n      );\r\n  }\r\n}\r\n","import { ChangeDetectionStrategy, Component } from '@angular/core';\n\nimport { Action } from 'src/tools/action';\nimport { State } from 'src/tools/state';\nimport { AppService, Hero } from './app.service';\n\n@Component({\n  selector: 'app-root',\n  template: `\n    <h1>Angular Reactive Actions</h1>\n    <div class=\"container\">\n      <ng-container *ngIf=\"request.$ | async as data\">\n        <p class=\"gap\">\n          <button (click)=\"getHeroes()\">Heroes</button>\n          <button (click)=\"getVillains()\">Villains</button>\n        </p>\n        <span *ngIf=\"data.loading\">Loading...</span>\n        <span *ngIf=\"data.error\">Error! {{ data.error }}</span>\n        <h4 *ngIf=\"data.pristine\">Click to show table of heroes.</h4>\n        <ng-container *ngIf=\"data.payload\">\n          <table>\n            <thead>\n              <tr>\n                <th>Name</th>\n                <th>Level</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr *ngFor=\"let row of data.payload\">\n                <td>{{ row.name }}</td>\n                <td>{{ row.level }}</td>\n              </tr>\n            </tbody>\n          </table>\n        </ng-container>\n      </ng-container>\n      <ng-container *ngIf=\"copy.$ | async as data\">\n        <h4 *ngIf=\"!!data.length\">\n          This is a copy of heroes [length = {{ data.length }}], but it can be used to store some state of application.\n        </h4>\n      </ng-container>\n    </div>\n  `,\n  styles: [\n    `\n      .container {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        padding: 1rem;\n      }\n\n      .gap > * {\n        margin: 0 .5rem .5rem;\n      }\n\n      h1, th, td {\n        text-align: center;\n      }\n\n      th, td {\n        padding: .5rem;\n      }\n\n      th {\n        font-weight: bold;\n      }\n    `\n  ],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppComponent {\n  readonly request = new Action<Hero[]>();\n  readonly copy = new State<Hero[]>([]);\n\n  constructor(private appService: AppService) { }\n\n  getHeroes() {\n    this.request.exec(\n      this.appService.getHeroes(),\n      (response) => {\n        console.log('success', response);\n        this.copy.setValue(response.slice());\n      },\n      (error) => console.log('error', error)\n    );\n  }\n\n  getVillains() {\n    this.request.exec(\n      this.appService.getVillains(),\n      (response) => console.log('success', response),\n      (error) => console.log('error', error)\n    );\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { BrowserModule } from '@angular/platform-browser';\n\nimport { AppService } from './app.service';\nimport { AppComponent } from './app.component';\n\n@NgModule({\n  declarations: [AppComponent],\n  imports: [BrowserModule],\n  providers: [AppService],\n  bootstrap: [AppComponent]\n})\nexport class AppModule { }\n","import { BehaviorSubject } from 'rxjs';\r\n\r\nexport class State<T> {\r\n  private source: BehaviorSubject<T>;\r\n\r\n  get value() {\r\n    return this.source.value;\r\n  }\r\n  get $() {\r\n    return this.source.asObservable();\r\n  }\r\n\r\n  constructor(initialValue: T) {\r\n    this.source = new BehaviorSubject(initialValue);\r\n  }\r\n\r\n  setValue(value: T) {\r\n    this.source.next(value);\r\n  }\r\n}\r\n","import { BehaviorSubject, Observable, of } from 'rxjs';\r\nimport { first, concatMap, catchError, shareReplay } from 'rxjs/operators';\r\n\r\nexport interface Wrapper<T> {\r\n  payload: T | undefined;\r\n  loading: boolean;\r\n  error: string;\r\n  pristine: boolean;\r\n  valid: boolean;\r\n}\r\n\r\nexport interface Error {\r\n  status: number;\r\n  message: string;\r\n}\r\n\r\nconst wrapper = (\r\n  payload, loading = false, error = '', pristine = true, valid = false\r\n) => ({\r\n  payload, loading, error, pristine, valid\r\n});\r\n\r\nexport class Action<T> {\r\n  private source: BehaviorSubject<Wrapper<T>>;\r\n\r\n  constructor(initialValue?: T) {\r\n    this.source = new BehaviorSubject(wrapper(initialValue));\r\n  }\r\n\r\n  get value() {\r\n    return this.source.value;\r\n  }\r\n  get $() {\r\n    return this.source.asObservable();\r\n  }\r\n\r\n  public exec(\r\n    request: Observable<T | undefined>,\r\n    onSuccess = (res: T) => { },\r\n    onError = (err: Error) => { },\r\n    mutation = (res: T) => {\r\n      return res;\r\n    }\r\n  ) {\r\n    this.source.next(wrapper(undefined, true, '', false));\r\n    request\r\n      .pipe(\r\n        first(),\r\n        concatMap((res: T) => {\r\n          onSuccess(res);\r\n          const result = mutation(res);\r\n          return of(wrapper(result, false, '', false, true));\r\n        }),\r\n        catchError((err: Error) => {\r\n          onError(err);\r\n          return of(wrapper(undefined, false, err.message, false));\r\n        }),\r\n        shareReplay(1)\r\n      )\r\n      .subscribe((result) => this.source.next(result));\r\n  }\r\n\r\n  public reset() {\r\n    this.source.next(wrapper(undefined));\r\n  }\r\n}\r\n","import { enableProdMode } from '@angular/core';\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\n\nimport { AppModule } from './app/app.module';\n\nenableProdMode();\n\nplatformBrowserDynamic().bootstrapModule(AppModule)\n  .catch(err => console.error(err));\n","function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nmodule.exports = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = \"zn8P\";"]}